language: csharp

solution: Srclib.Nuget.sln

sudo: true

before_install:
  - git submodule update --init
  - pwd
  - ls -al testdata/case/Proxy
  - wget http://download.savannah.gnu.org/releases/libunwind/libunwind-1.1.tar.gz
  - tar -xvf libunwind-1.1.tar.gz
  - cd libunwind-1.1 && ./configure && make > /dev/null 2>&1
  - sudo make install
  - cd ..
  - curl -sSL https://raw.githubusercontent.com/aspnet/Home/dev/dnvminstall.sh | DNX_BRANCH=dev sh && source ~/.dnx/dnvm/dnvm.sh
  - sudo apt-get install gettext libssl-dev libcurl4-openssl-dev zlib1g libicu-dev uuid-dev
  - dnvm upgrade -r coreclr
  - pwd
  - which dnu
  - dnu restore Srclib.Nuget/project.json
  - mkdir -p $HOME/bin
  - mkdir $HOME/.srclib/
  - mkdir $HOME/.srclib/sourcegraph.com
  - mkdir $HOME/.srclib/sourcegraph.com/sourcegraph
  - export PATH=$PATH:$HOME/bin
  - curl -Lo $HOME/bin/srclib.gz https://srclib-release.s3.amazonaws.com/srclib/0.2.0/linux-amd64/srclib.gz 
  - gunzip -c $HOME/bin/srclib.gz > $HOME/bin/srclib
  - sudo chmod +x $HOME/bin/srclib
  - ln --symbolic . $HOME/.srclib/sourcegraph.com/sourcegraph/srclib-csharp
  - srclib toolchain list
  - cd testdata/case/Proxy
  - srclib config
  - dnx -p ../../../Srclib.Nuget/project.json run scan
  - cd ../../..
  - srclib -v test

install:
  - pwd

script:
  - pwd
  - dnu restore Srclib.Nuget/project.json
  - srclib -v test
 
